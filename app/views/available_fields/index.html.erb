<% provide(:title, 'Available Fields') %>
<% provide(:include_menu, 'false') %>
<div class="container ngf ngf2" style="">
	<div class="col-md-8 col-md-offset-2">
		<%= render 'shared/logo' %>

		<div style="text-align:center;margin-top:20px; margin-bottom:30px;">
		  <span class="step finish"></span>
		  <span class="step active"></span>
		  <% if current_user.card_last4.nil? %>
		    <span class="step"></span>
		  <% end %>
		  <span class="step"></span>
		</div>
		<div class="card">
			<div class="header">
				<h4>Choose Venue and time</h4>		
			</div>
			<div class="row">
				<div class="col-md-6 col-md-offset-3" style="padding-top: 20px;">
					<h3 class="lead"><%= link_to "Create Custom Venue", new_custom_venue_path(game: params[:game]), class: "lead" %></h3>
				</div>
			</div>
			<hr>
			<div class="content">
				<div class="row">
					<div class="col-md-6 col-md-offset-3" style="margin-bottom: 10px;">
					<h3 class="lead">Find a private field near you</h3>
					</div>
					<nav class="navbar select-field-nav" style="margin-top: 20px;">
						<div class="container-fluid">
					    	<%= form_tag(available_fields_path, :method => "get", class: "") do %>
					    		<div class="col-md-4 col-md-offset-1 col-sm-5 col-xs-12">
					    			<%= label_tag :date%>
					    			<div class="input-group">
					    			  <span class="input-group-addon" id="basic-addon1"><i class="fa fa-calendar"></i></span>
					    			  <%= text_field_tag :date, params[:date], data:{ provide:'datepicker', 'date-format' => 'dd-mm-yyyy', 'date-autoclose' => 'true' }, placeholder: "DD-MM-YYYY", class: "form-control" %>
					    			</div>
					    		</div>
					    		<div class="col-md-4 col-sm-5 col-xs-12">
					    			<%= label_tag :time %>
					    			<div class="input-group">
					    			  <span class="input-group-addon" id="basic-addon1"><i class="fa fa-clock-o"></i></span>
					    			  <%= text_field_tag :time, params[:time], placeholder: "HH:MM AM/PM", class: "form-control" %>
					    			</div>
					    		</div>
					    		<div class="col-md-2 col-sm-2">
					    			<%= submit_tag "Search", class: "btn btn-primary btn-fill btn-srch" %>
					    		</div>
					    			
					    	<% end %>
					    	<!-- cus-->
						</div>
					</nav>
				</div>


				<div class="row">
					<% if @businesses.present? %>
					<p class="srch-msg"> 
						Showing results for "<%= params[:date]%>, <%= params[:time] %>"
					</p>
					<table class="table table-hover table-responsive">
						<thead>
							<th>Location</th>
							<th></th>
							<th>Select</th>
						</thead>
						<tbody class="">

					 		<% @businesses.each do |key, business| %>
						 		<tr>
						 			<td>
						 				<% if business[0].avatar_file_name.nil? %>
						 				    <%= image_tag("300x200.png", :alt => "rss feed") %>
						 				  <% else %>
						 				     <%= image_tag business[0].avatar.url(:medium)  %>
						 				  <% end %>
						 			</td>
						 			<td >
						 				<%= link_to business[0].name, business[0] %><br>
						 				Field: <%= business[1].name %>, Price: <%= business[1].price %><br>
						 				<i class="fa fa-map-marker"></i> <%= business[0].city %>, <%= business[0].state %>
						 			</td>
						 			<td>
					 					<%if !business[2].nil? %>
					 						<% if current_user.card_last4.nil? %>
					 							<%= link_to new_payment_method_path(game: business[2],business: business[0].id, date: params[:date], time: params[:time], field: business[1].id), class: "select" do %>
					 								<i class="fa fa-chevron-circle-right"></i>
					 							<% end %>
					 						<%else%>
					 							<%= link_to confirmation_path(game: business[2] , business: business[0].id, date: params[:date], time: params[:time], field: business[1].id), class: "select" do %>
					 								<i class="fa fa-chevron-circle-right"></i>
					 							<% end %> 
					 						<% end %>
					 				    <% end %>
						 			</td>
						 		</tr>       		
					 		<% end %>
				 		</tbody>
				 	</table>
					<% else %>
					  <p class="srch-msg"> <%= @message %></p>
					<% end %>
					<hr>
					<div class="card-btns">
						<%= link_to 'Cancel', root_path, class: "btn btn-large btn-default pull-right" %> 
					</div>
				</div>
			</div><!-- end content -->
		</div><!-- end card -->
	</div>
</div>